<html>
  <head>
    <!-- Stylesheets in here -->
    <% include ./partials/head %>
    <link rel="stylesheet" href="/stylesheets/lobby.css">
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.0.0/dist/aframe-physics-system.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.0.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script src="/javascripts/easyrtc.js"></script>
    <script src="https://unpkg.com/networked-aframe@^0.5.1/dist/networked-aframe.min.js"></script>

    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.5/dist/aframe-particle-system-component.min.js"></script>
    <script src="/javascripts/spawn-in-circle.component.js"></script>
    <script src="https://unpkg.com/super-hands@2.1.0/dist/super-hands.min.js"></script>

    <script>
        // Define custom schema for syncing avatar color, set by random-color
        NAF.schemas.add({
          template: '#avatar-template',
          components: [
            'position',
            'rotation',
            {
              selector: '.head',
              component: 'material',
              property: 'color'
            }
          ]
        });
      </script>
  </head>
  <body>    
      <a-scene id="game" hidden networked-scene=<%- '"app:maze_escape; room:' + roomName + '; adapter:easyrtc; audio:true;"'%>>
      <a-assets>

        <img id="grid" src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png" crossorigin="anonymous">
        <img id="sky" src="https://img.gs/bbdkhfbzkk/2048x2048,stretch/http://i.imgur.com/WqlqEkq.jpg" crossorigin="anonymous" />

        <a-asset-item id="maze" src="/models/maze.gltf"></a-asset-item>
        <a-asset-item id="maze-nav-mesh" src="/models/maze_nav-mesh.gltf"></a-asset-item>

        <!-- Templates -->

        <!-- Avatar -->
        <script id="avatar-template" type="text/html">
          <a-entity class="avatar" networked-audio-source>
            <a-sphere class="head"
              color="#5985ff"
              scale="0.45 0.5 0.4"
              random-color
            ></a-sphere>
          </a-entity>
        </script>

        <!-- /Templates -->
      </a-assets>
      <a-entity gltf-model="#maze" static-body="shape: box;"></a-entity>
      <!-- Nav Mesh -->
      <a-entity gltf-model="#maze-nav-mesh" nav-mesh></a-entity>

      <a-entity progressive-controls movement-controls="constrainToNavMesh: true;" position="20.5 0 -20">
        <a-entity id="player" networked="template:#avatar-template;showLocalTemplate:false;" camera position="0 1.6 0" look-controls></a-entity>
        <a-entity id="rightHand" position="0 1.6 0" class="right-controller"></a-entity>
        <a-entity id="leftHand" position="0 1.6 0" class="left-controller"></a-entity>
      </a-entity>

      

      <a-entity static-body position="0 0 0"
        geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0"
        material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;"></a-entity>

      <a-entity light="color: #ffffff; intensity: 1; type: ambient;" visible=""></a-entity>
      <a-entity light="color: #ffaaff; intensity: 1.5" position="5 5 5"></a-entity>

      <a-sky src="#sky" rotation="0 -90 0"></a-sky>
    </a-scene>

    <main class="container">
      <div class="row title-text">
        <div class="col-lg-12 text-center align-text-bottom">
          <h1>MAZE ESCAPE</h1>
          <h3 id="lobby-status">Waiting for Players</h3>
        </div>
      </div>
      <div id="warning-alert-div" class="row hide-element">
        <div id="warning-alert" class="alert alert-warning offset-lg-4 col-lg-4 text-center">
          You are still waiting on 1 player(s), before you can start the lobby.
        </div>
      </div>
      <div id="starting-alert-div" class="row hide-element">
          <div id="warning-alert" class="alert alert-success offset-lg-4 col-lg-4 text-center">
            Game starting in <span id="countdown-span">5</span>...
          </div>
        </div>
      <div class="row offset-lg-3 col-lg-6 lobby-text">
        <div class="col-lg-6 text-right">
          <p>Lobby Name:</p>
        </div>
        <div class="col-lg-6 text-left">
          <p><%-roomName%></p>
        </div>
      </div>
      <div class="row offset-lg-3 col-lg-6 lobby-text">
        <div class="col-lg-6 text-right">
          <p>Map Name:</p>
        </div>
        <div class="col-lg-6 text-left">
          <p>Maze 1</p>
        </div>
      </div>
      <br>
      <div class="row offset-lg-3 col-lg-6">
        <div class="text-center col-lg-12 lobby-text">
          <p>Currently Selected Role: <span id="selected-role">None</span></p>
          <medium class="form-text text-muted">Click to Select Role From Buttons Below</medium>
        </div>
        <div class="col-lg-12 text-center class-buttons-container">
          <button id="btn-lib" class="btn btn-lg">Librarian<br><span id="lib-btn-span">0/1</span></button>
          <button id="btn-run" class="btn btn-lg">Runner<br><span id="run-btn-span">0/1</span></button>
        </div>
      </div>
      <br><br>
      <div class="row offset-lg-3 col-lg-6">
          <div class="col-lg-12 text-center">
            <button disabled id="start-button" class="btn btn-lg btn-success">Lock In</button>
            <a href="/lobbylist">
              <button class="btn btn-lg btn-danger">Leave</button>
            </a>
          </div>
        </div>
    </main>

    <footer>
      <!-- Scripts throw in here -->
      <% include ./partials/footer %>
      <script src="/javascripts/lobby.js"></script>
    </footer>
  </body>
</html>
